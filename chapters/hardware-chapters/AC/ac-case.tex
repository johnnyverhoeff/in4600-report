% !TeX root = ../../../thesis.tex

\section{AC Environment}
\label{sec:ac-environment}




The translation from an ID, that is assigned to a light fixture, to a unique current signature is more difficult in an AC environment compared to the DC environment.
This is due to the supplied voltage.
In a DC environment, the voltage is a constant value, but in an AC environment the supplied voltage is a sinusoidal wave.
This means that the voltage will be both positive and negative.
In the Netherlands the AC has an RMS voltage of 230 V and a frequency of 50 Hz.

In the next subsections, we will first describe existing hardware and their limitations.
Then new hardware is proposed to solve the limitations of the existing hardware.
Finally, the AC testbed is showcased.




\input{chapters/hardware-chapters/AC/ac-modulator/ac-modulator}









\subsection{Current Sampler}

To measure AC current there are products on the market.
One such a product is a `Hall Effect-Based Linear Current Sensor' \cite{hall-ac-current-sensor-datasheet}.
Based on the Hall effect, this sensor outputs a voltage which is linear dependent on the current that goes through the sensor.
The 230 V AC is magnetically decoupled from the output voltage, due to the Hall effect.
Since the AC current can be both positive and negative, the output voltage of the sensor is half of the applied $V_{cc}$ when no current is being drawn.
When the current is positive the output voltage can go up to the $V_{cc}$ and when the current is negative the output voltage can go down to the GND voltage. 
The output voltage can therefor be directly attached to the input of an ADC.


Unfortunately, this sensor has the issue that the noise is produces is too great for the sensitivity it has.
According to \cite{hall-ac-current-sensor-datasheet}, the highest sensitivity is $185$ mV / A.
The commercial LED fixtures which were provided, are rated at $15$ Watts.
With the 230 V AC, this works out to a current of $I = \frac{P}{U} = \frac{15}{230} = 0.065$ A.
At that current the output voltage will be $185 \times 0.065 = 12$ mV.
The noise of the output is $21$ mV, which is almost double the output voltage when one LED is on.
This sensor would not be able to reliably detect one or two LEDs.
And so it was decided that a series resistor would be used.

Because of the AC the voltage over the series resistor will be both positive and negative.
So the output voltage needs to be lifted up before it can go to an ADC.
When the voltage is within bound for the ADC, nothing is yet decoupled from the microprocessor.
So an isolation IC is used to isolate the external ADC from the microprocessor.

The current sampler also needs to know when to start looking for the encoded information.
Just like the LED modulator needs to know when to start encoding.
So the same triggering circuit is also used for the current sampler.

The full schematic of the current sampler can be found in \autoref{app:custom-current-sampler-schematic}.
An architectural overview can be seen in \autoref{fig:ac-current-sampler-architectural}.

%\begin{figure}[htb]
%	\centering
%	\includegraphics[angle=0,width=0.8\textwidth,keepaspectratio]{chapters/hardware-chapters/ac-current-sampler-architectural.JPG}
%	\caption{Architectural overview of the AC current sampler.}
%	\label{fig:ac-current-sampler-architectural}
%\end{figure}





\subsection{Testbed}
\label{subsec:ac-testbed}

The full AC testbed consists of three custom LED modulators with three (provided) commercial DC LED fixtures.
The modulators are connected in parallel. 
And in series is the custom current sampler to measure the current and decode the information that the modulators encode.
All micro-controllers are stand-alone.
In \autoref{fig:ac-test-bed-architectural}, the architectural overview can be seen of this testbed and in \autoref{app:ac-test-bed} a picture can be seen of the actual testbed.

%\begin{figure}[htb]
%	\centering
%	\includegraphics[angle=0,width=\textwidth,keepaspectratio]{chapters/hardware-chapters/ac-test-bed-architectural.JPG}
%	\caption{Architectural overview of the AC testbed. Three LED modulators, with switches to turn the LED on and off, are connected in parallel %with each other and in series with the current sampler.}%
%	\label{fig:ac-test-bed-architectural}
%\end{figure}



