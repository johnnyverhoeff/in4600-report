% !TeX root = ../../thesis.tex

\chapter{Design Requirements}
\label{chp:design-requirements}

In this chapter, the requirements of both hardware and software will be explained.
First the software side and then the hardware side will be detailed.
Buildings traditionally only have AC power, but there is also research being done \todo{Citation needed, from NL or other origin ???} in using DC power in buildings. 
Therefor each section will also contain the implications on using DC or AC.
In \autoref{fig:overview-diagram} a block diagram can be seen how all components interact with each other.


\begin{figure}[h]
	\centering
	\resizebox {\textwidth} {!} {
		\begin{tikzpicture}

			\node[block] (smart_meter) {Smart-meter};	

			\node[block, left = 1cm of smart_meter] (power) {Power};	
			\draw[line] (power.east) -- (smart_meter.west) node [midway, right] {};		

			% second mod.
			\node[block, right = 4cm of smart_meter] (second_modulator) {Modulator};
			\node[LED, right = 0.5cm of second_modulator] (second_led) {LED};
			\draw[line] (second_modulator.east) -- (second_led.west) node [midway, right] {};

			% first mod.
			\node[block, above = 1cm of second_modulator] (first_modulator) {Modulator};
			\node[LED, right = 0.5cm of first_modulator] (first_led) {LED};
			\draw[line] (first_modulator.east) -- (first_led.west) node [midway, right] {};

			% third mod.
			\node[block, below = 1cm of second_modulator] (third_modulator) {Modulator};
			\node[LED, right = 0.5cm of third_modulator] (third_led) {LED};
			\draw[line] (third_modulator.east) -- (third_led.west) node [midway, right] {};

			\node[dot, right = 2.5cm of smart_meter] (CP) {};

			\draw (smart_meter.east) -- (CP) node [pos=0.3, above] {0222};

			\draw (CP) |- (first_modulator.west) node  [pos=0.75, above] {0011};
			\draw (CP) |- (second_modulator.west) node [pos=0.75, above] {0110};
			\draw (CP) |- (third_modulator.west) node  [pos=0.75, below] {0101};

		\end{tikzpicture}
	}
	\caption{Block diagram how each component interacts with other components.}
	\label{fig:overview-diagram}
\end{figure}


	\section{Encoding}

	To be able to distinguish multiple lights from each other, which are all connected in parallel, each light must have a unique identification sequence of some sort.
	Furthermore, that identification sequence must somehow be detected and interpreted by a smart-meter.


	If the transmission of the identification sequence is done with OOK (on-off keying) in a VLC manner, that encoding will also propagate through the current that is drawn.
	That current flows through the smart meter and then the light source which draws that current can be identified by its unique identification sequence. 


	A problem rises when more than one light source is sending its identification sequence.
	Since the lights are connected in parallel, the current that flows through the smart meter will be the sum of all the currents that are drawn by all the light sources.
	This means that the light sources, which are effectively transmitters, interfere with each other.
	Because of that interference the unique identification sequences which are assigned to each light source, need to be carefully selected.


	The field of telecommunications already faced similar issues: For example multiple cellphones transmitting to the same base station, at the same time, at the same frequency. 
	The solution was to use code sequences that do not posses high cross-correlations, but do have high auto-correlations.
	The specific codes are called Orthogonal codes and Pseudo random noise codes.
	The following requirements for the codes that will be used must be met:
	\begin{itemize}
		\item The codes need to work in a synchronous and asynchronous manner. Because multiple lights in a single room can be all switched on together, this is a synchronous case.	But when there are multiple lights in multiple rooms they need not be turned on or off at the same time, this is the asynchronous case.

		\item The codes should not be too long, because the system must identify each LED as being on or off in a timely manner.

		\item The method to create these codes should also produce a number of codes that is proportional to the length of code for the scalability of the system.
	\end{itemize}
	

	The exact properties, benefits and drawbacks and how they can be used in both DC and AC environments will be discussed in \autoref{chp:cdma}.




	\section{LED Modulator}

	A piece of hardware is needed to modulate a commercial LED.
	This hardware needs to translate the unique identification sequence that is assigned to each light source and modulate the LED.
	The modulation needs to be done in such a way that the aggregated current of all lights can be measured at the smart meter.  
	The hardware should also allow for fast modulating to avoid seeing flickering effects.


	For the design of this hardware, or when using pre-designed hardware, the way the identification sequence translates to the current draw needs to be taken in mind. 
	When DC is used the voltage is constant in time so the manner in which the encoding information from the LED translated into the current draw will be time-independent.
	But when using AC the applied voltage is a sine wave, so it is not constant in time and the voltage will also be positive and negative.
	So the supplied voltage is never the same and it is zero crossing, meaning that there no current will flow at that point in time.
	And when there is no current flow, there can also be no information encoding.
	For these problems in the AC domain, a combination of hardware and software will be used to get around these problems.



	\section{Smart Meter}

	The smart meter needs to be able to detect relatively small current changes.
	More concretely, it needs to be able to detect the current change when even a single light is modulating, while multiple other lights are on.

	When selecting a method of measuring the current these thing need to be taken into consideration:

	\begin{itemize}
		\item The speed at which the current can be sampled needs to be high enough to be able to correctly sample the current as the LEDs are modulating.

		\item The accuracy of the samples being taken needs to be high enough, so that the modulation of one LED can be detected with consistency.
		In other words, the noise of the samples must be low enough to detect the correct modulation of even one LED.

		\item The applied voltage to the microprocessor cannot be higher than the rated voltage of that microprocessor. This means that the sensitivity (mV / A) of the measuring method needs to be chosen in such a way that the output voltage of the measuring method, is within bounds to not damage the microprocessor.
		The microprocessor cannot handle the negative current, in the case of AC. So an intermediary step needs to take place here to convert it to something the microprocessor can handle, meaning only positive voltages and below the rated voltage of that microprocessor.

	\end{itemize}


















