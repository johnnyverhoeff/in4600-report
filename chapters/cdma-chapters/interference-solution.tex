% !TeX root = ../../thesis.tex

\section{Interference Solution}
\label{sec:interference-solution}

In the previous sections, interference was discussed when using a CDMA approach.
When there are too many transmitters on the same channel, at the same time, the interference can be so great that it destroys a code sequence of one or more transmitters.
This is not a problem for orthogonal sequences, since they have no cross correlation, when transmitted synchronously (See \autoref{subsec:orthogonal-sequences}).
But this is an issue for Gold sequences. 
As stated in \autoref{subsec:gold-sequences}, the cross-correlation of Gold sequences is bounded by $t(n)$, see \autoref{eq:gold-t(n)}.
This means that the maximum number of transmitters can be calculated such that not too much interference will occur. 
With this information two methods can be used to overcome the interference problem.



\subsection{Continuous Method}
\label{subsec:continuous-method-modulation}


One method is to only use the maximum number of transmitters such that no interference will occur.
A threshold $T$ must be set for which we will accept or reject a correlation as being a valid result.
When a particular code sequence is present in the received signal, the correlation will be equal to the length of the code, $L$.
To prevent false negatives, meaning there is a code sequence present in the received signal but it is lost due to too much interference from other code sequences, the correlation result needs to be higher than the threshold $T$.
Lets say we have a signal with $m$ codes and we correlate with a code that is also present in this signal.
The correlation for the code that is present will be $L$ and the correlation for all the other codes will be bounded by $t(n)$.
%The correlation result itself is equal to $R = L + \displaystyle\sum_{t = 0} ^ {L - 1} \Bigg\{ c_0(t) \times  \displaystyle\sum_{i = 1} ^ {m} c_i(t) \Bigg\} $ (See \autoref{sec:mapping-problem}).
Assuming the worst case scenario and each correlation with each other code sequence will be the negative of the absolute maximum cross correlation $t(n)$, the correlation is: $R = L - m \times t(n)$, where $m$ is the number of transmitters.
The correlation needs to be higher than the threshold $T$ to prevent false negatives, so we get the following equation \autoref{eq:gold-max-tx-pt1}.

\begin{equation}
	\label{eq:gold-max-tx-pt1}
	R = L - m \times t(n) > T
\end{equation}

Now to also prevent false positives, meaning for the code sequence that we are correlating with is not present but due to interference the correlation result suggests that it is present, we get \autoref{eq:gold-max-tx-pt2}.


\begin{equation}
	\label{eq:gold-max-tx-pt2}
	R = m \times t(n) < T
\end{equation}

If we equalize \autoref{eq:gold-max-tx-pt1} and \autoref{eq:gold-max-tx-pt2}, we can calculate what $m$ and $T$ are.
The results can be seen in \autoref{eq:m} and \autoref{eq:T}, respectively.


\begin{equation}
	\label{eq:m}
	m = \frac{L}{2 \times t(n)}
\end{equation}

\begin{equation}
	\label{eq:T}
	T = \frac{L}{2}
\end{equation}


Using the equations above, a table can be compiled showing the maximum number of simultaneous transmitters for which it is guarantied that there will be no false-positives and/or false-negatives when decoding the incoming signal.
The table can be seen in \autoref{tbl:correlation-gold-families}, since $m$ is a real number but the number of transmitters can only be an integer, the `floor' function is used on $m$. If the `ceil' or `round' function was used, the result could exceed $m$ and interference free decoding can only be guaranteed if the number of transmitters concurrently transmitting is equal or less than $m$.
 %\cite{holmes2007spread}



%\begin{table}[t]
%	\centering
%	\begin{tabular}{ | l | l | l | l | l |  }
%
%		\hline
%		LFSR size (n) 	& Code length (L)	& Number of codes (C)	& Cross-corr. ($|t(n)|$) 	& $m$	\\ \hline
%
%		3				& 7					& 9						& 5							& 0.70	\\ \hline
%		%4				& 15				& 17					& 9							& 0.83	\\ \hline %because mod 4 ....
%		5				& 31				& 33					& 9							& 1.72	\\ \hline
%		6				& 63				& 65					& 17						& 1.85	\\ \hline
%		7				& 127				& 129					& 17						& 3.74	\\ \hline
%		%8				& 255				& 257					& 33						& 3.86	\\ \hline is not a preferred pair for because mod 4 etc...			
%		9				& 511				& 513					& 33						& 7.74	\\ \hline%
%		10				& 1023				& 1025					& 65						& 7.87	\\ \hline	%
%		%
%
%	\end{tabular}
%	\caption{Table containing the maximum number of simultaneous transmitters $m$, such that no destructive interference takes place.}
%	\label{tbl:correlation-gold-families}
%\end{table}

\begin{table}[t]
	\centering
	\begin{tabular}{ | l | l | l | l | l |  }

		\hline
		Code length (L)	& Peak cross-correlation 	& $\lfloor m \rfloor$	\\ \hline

		%7				& 5							& 0.70	\\ \hline
		31				& 9							& 1	\\ \hline
		63				& 17						& 1	\\ \hline
		127				& 17						& 3	\\ \hline		
		511				& 33						& 7	\\ \hline
		1023			& 65						& 7	\\ \hline
		

	\end{tabular}
	\caption{Table containing the maximum number of simultaneous transmitters $\lfloor m \rfloor$, such that no destructive interference takes place.}
	\label{tbl:correlation-gold-families}
\end{table}



Because of this value $m$, not all transmitters can transmit continuously.
But if we had a system with a total amount of $m$ transmitters, we could reverse calculate what code length to use such that all transmitters can transmit continuously.
In \autoref{eq:m}, $m$ is written as a function of $n$.
We need $n$ as a function of $m$, so that $L$ can be expressed as a function of $m$.
The length of the code sequence $L$ as a function of the number of simultaneous transmitters $m$ can be found in \autoref{eq:L-f(m)}.
For simplification reasons, the cross-correlation function $t(n)$ was taken for $n$ odd. 
The methods used to reverse calculate the equation is beyond the scope of this thesis.


\begin{equation}
	\label{eq:L-f(m)}
	L = \Bigg(\sqrt{2 \times m^2 + 2 \times m + 1} + \sqrt{2} \times m \Bigg)^2 - 1
\end{equation} 


What we can conclude from \autoref{eq:L-f(m)}, is that $L$ is a polynomial function of $m$.
The time $t$ it takes to complete one transmission can be found in \autoref{eq:time-for-m-txs}, where $L$ is length of the code, a function of $m$, the number of simultaneous transmitters, and $f$ is the constant modulating frequency in Hz.
This will guaranty good decoding properties, meaning no false-positives and/or false-negatives and all transmitters can transmit the entire time, simultaneous.
%Also the system is scalable as the time is dependent on a polynomial function of the number of transmitters.

\begin{equation}
	\label{eq:time-for-m-txs}
	t = \frac{L}{f}
\end{equation}


\begin{table}[t]
	\centering
	\begin{tabular}{  | l | l | l | }

	\hline
	Number of transmitters (m)	& Code Length (L)		& Time (t)					\\ \hline


	%1							& 31					& 0.0031 s					\\ \hline
	%3							& 127					& 0.0127 s					\\ \hline
	7							& 511					& 0.0511 s					\\ \hline 
	15							& 2047					& 0.2047 s					\\ \hline
	31							& 8191					& 0.8191 s					\\ \hline
	63							& 32767					& 3.2767 s					\\ \hline
	127							& 131071				& 13.107 s					\\ \hline
	255							& 524287				& 52.429 s					\\ \hline
	511							& 2097151				& 209.72 s (3.5 min)		\\ \hline
	1023						& 8388607				& 838.86 s (14.0 min)		\\ \hline
	2047						& 33554431				& 3355.4 s (55.9 min)		\\ \hline
	4095						& 134217727				& 13421.7 s (3.7 hour)		\\ \hline
	8191						& 536870911				& 53687.1 s (14.9 hour)		\\ \hline
	16383						& 2147483647			& 214748.4 s (2.5 day)		\\ \hline
	32767						& 8589934591			& 858993.5 s (1.4 week)		\\ \hline



\end{tabular}
	\caption{Table containing time it takes to receive each transmission from each transmitter, as a function of the number of transmitters, with a constant modulating frequency $f = 10$ kHz.}
	\label{tbl:continous-method-time-as-function-N}
\end{table}

\autoref{tbl:continous-method-time-as-function-N} states the time needed to receive a transmission from a transmitter as a function of the total number of transmitters in the systems. 
All the other transmitters in the system will also be transmitting at the same time.





\subsection{Probabilistic Method}
\label{subsec:probabilistic-method-modulation}



Another solution to overcome the interference problem, is to use a probabilistic approach.
The benefit of this method is that it can utilize all code sequences in the set, instead of a limited amount of them like in the solution above.
The drawback is that the time it takes to identify if all the LEDs are on or off becomes a function of the precision that the user requires.

Each transmitter is given $k$ slots, in one and only one of these slots will the transmitter transmit its code.
The probability that is associated with this is $p = \frac{1}{k}$.
Since the transmitters have a probability $p$ for which it will transmit and with probability $1 - p$ it will not transmit, they follow a Bernoulli distribution.
Since there is more than one transmitter which follows a Bernoulli distribution, the number of transmitters which will be transmitting at any point in time, is a Binomial distribution.
Now that every transmitter has a probability $p$, $p$ must be calculated such that no interference will take place and the number of slots $k$ needs to be determined.
When those values are calculated the time in order to successfully identify each LED can be calculated.




The probability $p$ must be chosen such that at every point in time the number of transmitters transmitting their sequence will not exceed $m$, in order to not have interference issues.
The cumulative distribution function for a binomial distribution can be seen in \autoref{eq:cdf-binomial}, where $X$ is the random variable for the number of transmitters at every point in time, $m$ is the maximum number of transmitter to avoid interference issues and $N$ is the total number of transmitters used.
The probability that $X \le m$ needs to be as high as possible to avoid the interference issue, but as the CDF goes asymptotically to $1$, we cannot choose the probability $1$.
Instead a value of $1 - \epsilon$ is chosen, where $\epsilon$ is the error, so $1 - \epsilon$ is the precision or accuracy.
\autoref{eq:cdf-binomial} is then equalized to $1 - \epsilon$ to find a probability $p$, since every other variable is known.
With the found probability $p$, the probability that the number of transmitters at every point in time, PR$(X \le m)$, will not exceed $m$ is equal to $1 - \epsilon$.

\begin{equation}
	\label{eq:cdf-binomial}
	\text{CDF:  PR}(X \le m) = \displaystyle\sum_{i=0}^{m} \binom Ni \times p^i \times (1 - p)^{N-i}
\end{equation}


Now that the probability $p$ can be calculated, $k$ can be calculated.
We know that $p = \frac{1}{k}$ so $k = \frac{1}{p}$.
After $k$ attempts the transmitter will have transmitted once.
This holds for one transmitter, but since each transmitter works in parallel and each random variable is independent and identically distributed, this holds for the entire system with $N$ transmitters.
Now the time it takes for all transmitters to have transmitted can be calculated.
The result can be seen in \autoref{eq:time-for-probabilistic-txs}, where $L$ is the length of the sequence, $f$ is the constant modulating frequency, $k$ is the number of slots and $p$ is the probability that a transmitter will transmit.
$L$ is a function of $N$, the number of transmitters in the system.
And $p$ is a function of the error $\epsilon$ and $N$.

\begin{equation}
	\label{eq:time-for-probabilistic-txs}
	t = \frac{L}{f} \times k = \frac{L}{f} \times \frac{1}{p}
\end{equation}

This probabilistic method allows to use all the sequences in the same set.
The drawback is that the time for which all transmitters have transmitted, is dependent on the accuracy $1 - \epsilon$.
In \autoref{tbl:probabilistic-method-time-as-function-N} the time it takes to let each transmitter transmit, is listed as a function of the number of transmitters in the total system and the error $\epsilon$. 
The time in the table is for a constant modulation frequency chosen to be 10 kHz, for other frequencies the time scales linearly, see \autoref{eq:time-for-probabilistic-txs}.






When $\epsilon$ is quite small, $\epsilon = 0.001$, the probability of interference is low, but the times grow larger. 
For $\epsilon = 0.1$, the times are smaller, but the probability of interference will be higher.
A simulation will be performed in order to asses what values of $\epsilon$  will give acceptable results.
The results of the simulation can be found in \autoref{sec:simulation-evaluation}.




\begin{table}[t]
	\centering
	\begin{tabular}{  | l | l | l | l | }

		\hline
		Number of transmitters (N)	& Code Length (L) 		& Time (t), $\epsilon = 0.001$				& Time (t), $\epsilon = 0.1$					\\ \hline

		9							& 7						& 6.31 s									& 0.06 s 										\\ \hline
		33							& 31					& 2.22 s									& 0.19 s 										\\ \hline
		65							& 63	 				& 8.91 s									& 0.77 s 										\\ \hline
		129							& 127					& 3.79 s									& 0.93 s  										\\ \hline
		513							& 511					& 13.24 s									& 5.62 s 										\\ \hline
		1025						& 1023					& 53.10 s									& 22.50 s 										\\ \hline
		2049						& 2047					& 65.36 s (1.09 min)						& 37.64 s										\\ \hline
		8193						& 8191					& 387.28 s (6.45 min)						& 268.38 s (4.47 min)							\\ \hline
		16385						& 16383					& 1549.95 s	(25.83 min)						& 1074.30 s	(17.90 min)							\\ \hline
		32769						& 32767					& 2551.95 s (42.53 min)						& 1989.50 s	(33.16 min)							\\ \hline


	\end{tabular}
	\caption{Table containing time it takes to let each transmitter transmit, as a function of the number of transmitters and error $\epsilon$, with a constant modulating frequency $f = 10$ kHz. }
	\label{tbl:probabilistic-method-time-as-function-N}

\end{table}




